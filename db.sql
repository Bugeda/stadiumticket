CREATE USER stadiumticket@localhost identified BY '1234';
GRANT usage ON *.* TO stadiumticket@localhost identified BY '1234';
CREATE DATABASE IF NOT EXISTS stadiumticket;
GRANT ALL privileges ON stadiumticket.* TO stadiumticket@localhost;
USE stadiumticket;

CREATE TABLE `EVENT_TYPES` (
  `EVENT_TYPE_ID` int(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `EVENT_TYPE_NAME` varchar(100) NOT NULL,
  PRIMARY KEY (`EVENT_TYPE_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `EVENTS` (
  `EVENT_ID` int(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `EVENT_TYPE_ID` INT(10) UNSIGNED NOT NULL,
  `EVENT_NAME` varchar(100) NOT NULL,
  `EVENT_DATE` TIMESTAMP,
  `BOOKING_TIME` SMALLINT DEFAULT 30,
  PRIMARY KEY (`EVENT_ID`),
KEY FK_event_type (`EVENT_TYPE_ID`),
CONSTRAINT FK_event_type FOREIGN KEY (`EVENT_TYPE_ID`) REFERENCES EVENT_TYPES (`EVENT_TYPE_ID`)) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `SECTORS` (
  `SECTOR_ID` int(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `EVENT_ID` int(10) UNSIGNED NOT NULL,
  `SECTOR_NAME` varchar(100) NOT NULL,
  `PRICE_SECTORS` DOUBLE NOT NULL,
  `IS_DIFFERENT_PRICE_SECTORS` BOOL DEFAULT 0,
  `PRICE_SECTORS2` DOUBLE,
  PRIMARY KEY (`SECTOR_ID`),
KEY FK_event (`EVENT_ID`),
CONSTRAINT FK_event FOREIGN KEY (`EVENT_ID`) REFERENCES EVENTS (`EVENT_ID`)) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `TICKETS` (
  `TICKET_ID` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `SECTOR_ID` int(10) UNSIGNED NOT NULL,
  `EVENT_ID` int(10) UNSIGNED NOT NULL,
  `TICKET_ROW_ID` SMALLINT NOT NULL,
  `TICKET_PLACE` SMALLINT NOT NULL,
    `STATE` TINYINT DEFAULT 0,
/*  0-продано, 1-забронировано, 2-свободно*/
  PRIMARY KEY (`TICKET_ID`),
KEY FK_sectors (SECTOR_ID),
CONSTRAINT FK_sectors FOREIGN KEY (SECTOR_ID) REFERENCES SECTORS (SECTOR_ID),
KEY FK_events (EVENT_ID),
CONSTRAINT FK_events FOREIGN KEY (EVENT_ID) REFERENCES EVENTS (EVENT_ID)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `BOOKING_TICKET` (
  `BOOKING_ID` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `USER_FIRSTNAME` varchar(100) NOT NULL,
  `USER_SECONDNAME` varchar(100) NOT NULL,
  `TICKET_ID` INT(10) UNSIGNED NOT NULL,
  `STATE` bool default 0,
 /* выкупил бронь или нет*/
  PRIMARY KEY (`BOOKING_ID`),
KEY FK_booking (TICKET_ID),
CONSTRAINT FK_booking FOREIGN KEY (TICKET_ID) REFERENCES TICKETS (TICKET_ID))
 ENGINE=InnoDB DEFAULT CHARSET=utf8;

INSERT INTO EVENT_TYPES (EVENT_TYPE_ID, EVENT_TYPE_NAME)
VALUES (1,'Футбольный матч'),(2,'Концерт'),(3,'Фестиваль'),(4,'Конференция'),(5,'Телепередача'),(6,'Спортивный турнир');

INSERT INTO EVENTS (EVENT_ID,EVENT_TYPE_ID,EVENT_NAME,EVENT_DATE)
VALUES
(1,1, 'Матч Кома1 vs Кома2','2014-06-07 18:00:00'),
(2,1, 'Матч Кома1 vs Кома3','2014-06-10 18:00:00'),
(3,1, 'Матч Кома3 vs Кома2','2014-06-13 18:00:00');

INSERT INTO SECTORS (EVENT_ID, SECTOR_NAME,PRICE_SECTORS)
VALUE
(1,'SKYBOX',350),(1,'VIP A',250),(1,'4',50),(1,'13',130),
(2,'VIP B',180),(2,'7',35),(2,'3',55),(2,'10','65'),
(3,'VIP D',150),(3,'13','250'),(3,'4','50'),(3,'Спорт-бар','210');


